<ContentDialog
    x:Class="Sphere_Schedule_App.Views.Dialogs.AddTaskDialog"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:Sphere_Schedule_App.Views.Dialogs"
    xmlns:converters="using:Sphere_Schedule_App.Converters"
    Title="Add New Task"
    PrimaryButtonText="Add Task"
    SecondaryButtonText="Cancel"
    DefaultButton="Primary"
    CornerRadius="12"
    Background="{ThemeResource ContentDialogBackground}"
    BorderBrush="{ThemeResource ContentDialogBorderBrush}"
    PrimaryButtonClick="ContentDialog_PrimaryButtonClick"
    SecondaryButtonClick="ContentDialog_SecondaryButtonClick"
    Loaded="ContentDialog_Loaded">

    <ContentDialog.Resources>
        <converters:BooleanToVisibilityConverter x:Key="BoolToVisibility"/>

        <Style x:Key="DialogTextBoxStyle" TargetType="TextBox">
            <Setter Property="Background" Value="{ThemeResource TextControlBackground}"/>
            <Setter Property="Foreground" Value="{ThemeResource TextControlForeground}"/>
            <Setter Property="BorderBrush" Value="{ThemeResource TextControlBorderBrush}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="CornerRadius" Value="8"/>
            <Setter Property="Padding" Value="12,8"/>
            <Setter Property="FontSize" Value="14"/>
        </Style>

        <Style x:Key="DialogComboBoxStyle" TargetType="ComboBox">
            <Setter Property="Background" Value="{ThemeResource ComboBoxBackground}"/>
            <Setter Property="Foreground" Value="{ThemeResource ComboBoxForeground}"/>
            <Setter Property="BorderBrush" Value="{ThemeResource ComboBoxBorderBrush}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="CornerRadius" Value="8"/>
            <Setter Property="Padding" Value="12,8"/>
            <Setter Property="FontSize" Value="14"/>
        </Style>

        <Style x:Key="PriorityButtonStyle" TargetType="RadioButton">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderBrush" Value="{ThemeResource SystemControlForegroundBaseMediumBrush}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="CornerRadius" Value="20"/>
            <Setter Property="Padding" Value="16,8"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="GroupName" Value="PriorityGroup"/>
        </Style>

        <Style x:Key="ErrorTextBlockStyle" TargetType="TextBlock">
            <Setter Property="Foreground" Value="#D32F2F"/>
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="Margin" Value="0,4,0,0"/>
            <Setter Property="Visibility" Value="Collapsed"/>
        </Style>
    </ContentDialog.Resources>

    <ScrollViewer VerticalScrollBarVisibility="Auto" MaxHeight="600">
        <Grid Width="500">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- Title (Required) -->
            <StackPanel Grid.Row="0" Grid.ColumnSpan="2" Margin="0,0,0,16">
                <TextBlock Text="Task Title *" FontWeight="SemiBold" Margin="0,0,0,4"/>
                <TextBox x:Name="TitleTextBox" 
                         Style="{StaticResource DialogTextBoxStyle}"
                         PlaceholderText="What needs to be done?"
                         MaxLength="255"
                         TextChanged="TitleTextBox_TextChanged"/>
                <TextBlock x:Name="TitleErrorText" 
                           Style="{StaticResource ErrorTextBlockStyle}"
                           Text="Task title is required"/>
            </StackPanel>

            <!-- Description (Optional) -->
            <StackPanel Grid.Row="1" Grid.ColumnSpan="2" Margin="0,0,0,16">
                <TextBlock Text="Description (Optional)" FontWeight="SemiBold" Margin="0,0,0,4"/>
                <TextBox x:Name="DescriptionTextBox" 
                         Style="{StaticResource DialogTextBoxStyle}"
                         PlaceholderText="Add details..."
                         AcceptsReturn="True"
                         TextWrapping="Wrap"
                         MinHeight="80"
                         MaxLength="2000"/>
            </StackPanel>

            <!-- Priority (Optional - defaults to medium) -->
            <StackPanel Grid.Row="2" Grid.ColumnSpan="2" Margin="0,0,0,16">
                <TextBlock Text="Priority" FontWeight="SemiBold" Margin="0,0,0,8"/>
                <StackPanel Orientation="Horizontal" Spacing="8">
                    <RadioButton x:Name="LowPriorityButton" 
                                 Style="{StaticResource PriorityButtonStyle}"
                                 Content="Low"
                                 Tag="low"/>
                    <RadioButton x:Name="MediumPriorityButton" 
                                 Style="{StaticResource PriorityButtonStyle}"
                                 Content="Medium"
                                 Tag="medium"
                                 IsChecked="True"/>
                    <RadioButton x:Name="HighPriorityButton" 
                                 Style="{StaticResource PriorityButtonStyle}"
                                 Content="High"
                                 Tag="high"/>
                    <RadioButton x:Name="CriticalPriorityButton" 
                                 Style="{StaticResource PriorityButtonStyle}"
                                 Content="Critical"
                                 Tag="critical"/>
                </StackPanel>
            </StackPanel>

            <!-- Category (Optional - loads from database and hardcoded defaults) -->
            <StackPanel Grid.Row="3" Grid.Column="0" Margin="0,0,8,16">
                <TextBlock Text="Category" FontWeight="SemiBold" Margin="0,0,0,4"/>
                <ComboBox x:Name="CategoryComboBox" 
                          Style="{StaticResource DialogComboBoxStyle}"
                          PlaceholderText="Select category">
                    <!-- Items will be populated from code-behind -->
                </ComboBox>
            </StackPanel>

            <!-- Due Date (Defaults to today) -->
            <StackPanel Grid.Row="3" Grid.Column="1" Margin="8,0,0,16">
                <TextBlock Text="Due Date" FontWeight="SemiBold" Margin="0,0,0,4"/>
                <DatePicker x:Name="DueDatePicker"
                            Style="{StaticResource DialogComboBoxStyle}"
                            Date="{x:Bind _defaultDueDate, Mode=OneWay}"/>
            </StackPanel>

            <!-- Due Time (Optional - toggleable) -->
            <StackPanel Grid.Row="4" Grid.ColumnSpan="2" Margin="0,0,0,16">
                <CheckBox x:Name="DueTimeToggle" 
                          Content="Set specific due time"
                          FontWeight="SemiBold"
                          Checked="DueTimeToggle_Checked"
                          Unchecked="DueTimeToggle_Unchecked"/>

                <StackPanel x:Name="DueTimePanel" 
                            Margin="24,8,0,0" 
                            Visibility="Collapsed"
                            Orientation="Horizontal"
                            Spacing="8">
                    <TextBlock Text="Time:" VerticalAlignment="Center"/>
                    <TimePicker x:Name="DueTimePicker"
                                Style="{StaticResource DialogComboBoxStyle}"
                                Width="120"/>
                    <TextBlock Text="(Optional)" 
                               FontStyle="Italic" 
                               Foreground="Gray"
                               VerticalAlignment="Center"/>
                </StackPanel>
            </StackPanel>

            <!-- Estimated Duration (Optional) -->
            <StackPanel Grid.Row="5" Grid.Column="0" Margin="0,0,8,0">
                <TextBlock Text="Estimated Duration (Optional)" FontWeight="SemiBold" Margin="0,0,0,4"/>
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    <ComboBox x:Name="HoursComboBox" 
                              Grid.Column="0"
                              Style="{StaticResource DialogComboBoxStyle}"
                              SelectedIndex="0">
                        <ComboBoxItem Content="0h" Tag="0"/>
                        <ComboBoxItem Content="1h" Tag="60"/>
                        <ComboBoxItem Content="2h" Tag="120"/>
                        <ComboBoxItem Content="3h" Tag="180"/>
                        <ComboBoxItem Content="4h" Tag="240"/>
                        <ComboBoxItem Content="6h" Tag="360"/>
                        <ComboBoxItem Content="8h" Tag="480"/>
                    </ComboBox>
                    <TextBlock Grid.Column="1" Text="+" Margin="4,0" VerticalAlignment="Center"/>
                    <ComboBox x:Name="MinutesComboBox" 
                              Grid.Column="2"
                              Style="{StaticResource DialogComboBoxStyle}"
                              SelectedIndex="0">
                        <ComboBoxItem Content="0m" Tag="0"/>
                        <ComboBoxItem Content="15m" Tag="15"/>
                        <ComboBoxItem Content="30m" Tag="30"/>
                        <ComboBoxItem Content="45m" Tag="45"/>
                    </ComboBox>
                </Grid>
            </StackPanel>
            

            <!-- Status -->
            <StackPanel Grid.Row="5" Grid.Column="1" Margin="8,0,0,0">
                <TextBlock Text="Status" FontWeight="SemiBold" Margin="0,0,0,4"/>
                <ComboBox x:Name="StatusComboBox" 
                          Style="{StaticResource DialogComboBoxStyle}"
                          SelectedIndex="0">
                    <ComboBoxItem Content="Pending" Tag="pending"/>
                    <ComboBoxItem Content="In Progress" Tag="in_progress"/>
                    <ComboBoxItem Content="On Hold" Tag="on_hold"/>
                </ComboBox>
            </StackPanel>

            <!-- Loading Indicator -->
            <Border Grid.Row="0" Grid.RowSpan="6" Grid.ColumnSpan="2"
                Background="#CCFFFFFF"
                x:Name="LoadingOverlay"
                Visibility="Collapsed"
                CornerRadius="12">
                <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center" Spacing="12">
                    <ProgressRing IsActive="True" Width="40" Height="40"/>
                    <TextBlock Text="Loading categories..." FontWeight="SemiBold"/>
                </StackPanel>
            </Border>

            <!-- Error Message -->
            <Border Grid.Row="0" Grid.RowSpan="6" Grid.ColumnSpan="2"
                    x:Name="ErrorBorder"
                    Background="#CCFFFFFF"
                    Visibility="Collapsed"
                    CornerRadius="12">
                <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center" Spacing="12">
                    <TextBlock x:Name="ErrorMessageText" 
                               Foreground="#D32F2F"
                               FontWeight="SemiBold"
                               TextWrapping="Wrap"
                               TextAlignment="Center"/>
                    <Button Content="Retry" 
                            Click="RetryButton_Click"
                            Padding="12,6"/>
                </StackPanel>
            </Border>
        </Grid>
    </ScrollViewer>
</ContentDialog>